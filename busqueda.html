<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buscar Repuestos - RepuestosYa</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --primary: #2563eb;
        --secondary: #f59e0b;
        --dark: #0f172a;
        --light: #f8fafc;
        --accent: #10b981;
        --gray: #64748b;
        --error: #ef4444;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        min-height: 100vh;
        padding: 2rem 1rem;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        animation: fadeInDown 0.6s ease;
      }

      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .logo {
        font-size: 1.8rem;
        font-weight: 800;
        color: var(--dark);
      }

      .logo span {
        color: var(--secondary);
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 1rem;
        color: var(--gray);
      }

      .user-name {
        font-weight: 600;
        color: var(--dark);
      }

      /* Card */
      .card {
        background: white;
        border-radius: 20px;
        padding: 3rem;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
        animation: fadeInUp 0.6s ease;
        margin-bottom: 2rem;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .page-title {
        font-size: 2rem;
        font-weight: 800;
        color: var(--dark);
        margin-bottom: 0.5rem;
      }

      .page-description {
        color: var(--gray);
        margin-bottom: 2.5rem;
        font-size: 1.05rem;
      }

      /* Vehicle Selector */
      .vehicle-selector-container {
        margin-bottom: 2rem;
      }

      .vehicle-selector-wrapper {
        position: relative;
      }

      .vehicle-selector-wrapper select {
        width: 100%;
        padding: 1rem;
        padding-left: 3rem;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
        appearance: none;
        background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2364748B"><path d="M7 10l5 5 5-5z"/></svg>');
        background-repeat: no-repeat;
        background-position: right 1rem center;
        background-size: 20px;
        cursor: pointer;
      }

      .vehicle-selector-wrapper select:focus {
        outline: none;
        border-color: var(--secondary);
        box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
      }

      .add-vehicle-link {
        display: inline-block;
        margin-top: 0.75rem;
        color: var(--secondary);
        text-decoration: none;
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s ease;
      }

      .add-vehicle-link:hover {
        color: #d97706;
        text-decoration: underline;
      }

      /* Vehicle Info Banner */
      .vehicle-banner {
        background: linear-gradient(135deg, #eff6ff, #dbeafe);
        padding: 1.25rem 1.5rem;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
      }

      .vehicle-icon {
        font-size: 2rem;
      }

      .vehicle-details {
        flex: 1;
      }

      .vehicle-label {
        font-size: 0.85rem;
        color: var(--gray);
        margin-bottom: 0.25rem;
      }

      .vehicle-name {
        font-weight: 700;
        color: var(--dark);
        font-size: 1.1rem;
      }

      /* Repuestos List */
      .repuestos-list {
        margin-bottom: 2rem;
      }

      .repuesto-item {
        background: var(--light);
        border: 2px solid #e2e8f0;
        border-radius: 15px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
      }

      .repuesto-item:hover {
        border-color: var(--secondary);
        box-shadow: 0 4px 12px rgba(245, 158, 11, 0.1);
      }

      .repuesto-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .repuesto-number {
        font-weight: 700;
        color: var(--dark);
        font-size: 1.1rem;
      }

      .remove-btn {
        background: transparent;
        border: none;
        color: var(--error);
        cursor: pointer;
        font-size: 1.3rem;
        padding: 0.25rem 0.5rem;
        transition: all 0.3s ease;
      }

      .remove-btn:hover {
        transform: scale(1.2);
      }

      .form-group {
        margin-bottom: 1rem;
      }

      label {
        display: block;
        font-weight: 600;
        color: var(--dark);
        margin-bottom: 0.5rem;
        font-size: 0.95rem;
      }

      .required {
        color: var(--error);
      }

      input[type="text"],
      textarea {
        width: 100%;
        padding: 0.875rem 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      input[type="text"]:focus,
      textarea:focus {
        outline: none;
        border-color: var(--secondary);
        box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.1);
      }

      textarea {
        resize: vertical;
        min-height: 80px;
      }

      .help-text {
        font-size: 0.85rem;
        color: var(--gray);
        margin-top: 0.5rem;
      }

      /* File Upload */
      .file-upload {
        border: 2px dashed #cbd5e1;
        border-radius: 10px;
        padding: 1.5rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
      }

      .file-upload:hover {
        border-color: var(--secondary);
        background: var(--light);
      }

      .file-upload.has-file {
        border-color: var(--accent);
        background: #d1fae5;
      }

      .upload-icon {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
      }

      .upload-text {
        color: var(--gray);
        font-size: 0.95rem;
      }

      .file-name {
        color: var(--dark);
        font-weight: 600;
        margin-top: 0.5rem;
      }

      input[type="file"] {
        display: none;
      }

      /* Add Button */
      .add-repuesto-btn {
        width: 100%;
        padding: 1rem;
        background: white;
        border: 2px dashed var(--secondary);
        color: var(--secondary);
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-size: 1rem;
      }

      .add-repuesto-btn:hover {
        background: var(--light);
        transform: translateY(-2px);
      }

      /* Summary Card */
      .summary-card {
        background: linear-gradient(135deg, #fef3c7, #fde68a);
        padding: 1.5rem;
        border-radius: 15px;
        margin-top: 2rem;
      }

      .summary-title {
        font-weight: 700;
        color: var(--dark);
        margin-bottom: 1rem;
        font-size: 1.1rem;
      }

      .summary-item {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        color: var(--dark);
      }

      .summary-label {
        color: var(--gray);
      }

      .summary-value {
        font-weight: 600;
      }

      /* Submit Button */
      .submit-button {
        width: 100%;
        padding: 1.25rem 2rem;
        background: var(--secondary);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        margin-top: 1.5rem;
      }

      .submit-button:hover {
        background: #d97706;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(245, 158, 11, 0.3);
      }

      .submit-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .submit-button.loading::after {
        content: "";
        width: 20px;
        height: 20px;
        border: 3px solid white;
        border-top-color: transparent;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Success Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.8);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }

      .modal.show {
        display: flex;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .modal-content {
        background: white;
        border-radius: 20px;
        padding: 3rem;
        max-width: 500px;
        width: 90%;
        text-align: center;
        animation: slideUp 0.4s ease;
      }

      @keyframes slideUp {
        from {
          transform: translateY(50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .success-icon {
        width: 100px;
        height: 100px;
        background: var(--accent);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1.5rem;
        font-size: 4rem;
        animation: scaleIn 0.5s ease;
      }

      @keyframes scaleIn {
        from {
          transform: scale(0);
        }
        to {
          transform: scale(1);
        }
      }

      .modal-title {
        font-size: 1.8rem;
        font-weight: 800;
        color: var(--dark);
        margin-bottom: 1rem;
      }

      .modal-message {
        color: var(--gray);
        font-size: 1.05rem;
        line-height: 1.6;
        margin-bottom: 2rem;
      }

      .modal-highlight {
        background: var(--light);
        padding: 1rem;
        border-radius: 10px;
        margin: 1.5rem 0;
      }

      .modal-highlight strong {
        color: var(--secondary);
        font-size: 1.2rem;
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 3rem 2rem;
        color: var(--gray);
      }

      .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
      }

      /* Responsive */
      @media (max-width: 768px) {
        body {
          padding: 1rem 0.5rem;
        }

        .card {
          padding: 2rem 1.5rem;
        }

        .header {
          flex-direction: column;
          gap: 1rem;
          text-align: center;
        }

        .page-title {
          font-size: 1.6rem;
        }

        .vehicle-banner {
          flex-direction: column;
          text-align: center;
        }

        .modal-content {
          padding: 2rem 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="logo">Repuestos<span>Ya</span></div>
        <div class="user-info">
          <span>üë§</span>
          <span class="user-name">Juan P√©rez</span>
        </div>
      </div>

      <!-- Main Card -->
      <div class="card">
        <h1 class="page-title">Buscar Repuestos üîç</h1>
        <p class="page-description">
          Agrega los repuestos que necesitas y recibir√°s ofertas de vendedores
          en minutos
        </p>

        <!-- Vehicle Selector -->
        <div class="vehicle-selector-container">
          <label for="vehiculoSelect"
            >¬øPara qu√© veh√≠culo buscas repuestos?
            <span class="required">*</span></label
          >
          <div class="vehicle-selector-wrapper">
            <div class="input-wrapper">
              <span class="input-icon">üöó</span>
              <select id="vehiculoSelect" required>
                <option value="">Selecciona un veh√≠culo</option>
                <option value="1" selected>Toyota Corolla 2018</option>
                <option value="2">Chevrolet Spark 2020</option>
              </select>
            </div>
          </div>
          <a href="perfil.html#vehiculos" class="add-vehicle-link">
            + Agregar otro veh√≠culo
          </a>
        </div>

        <form id="busquedaForm">
          <!-- Repuestos List -->
          <div class="repuestos-list" id="repuestosList">
            <!-- Repuesto Item 1 (Default) -->
            <div class="repuesto-item" data-index="0">
              <div class="repuesto-header">
                <span class="repuesto-number">üì¶ Repuesto #1</span>
              </div>

              <div class="form-group">
                <label
                  >Nombre del repuesto <span class="required">*</span></label
                >
                <input
                  type="text"
                  name="nombre_0"
                  placeholder="Ej: Pastillas de freno delanteras"
                  required
                />
              </div>

              <div class="form-group">
                <label>Descripci√≥n adicional</label>
                <textarea
                  name="descripcion_0"
                  placeholder="Agrega detalles que ayuden a los vendedores (marca espec√≠fica, tipo, etc.)"
                ></textarea>
                <p class="help-text">
                  Mientras m√°s detalles, mejores ofertas recibir√°s
                </p>
              </div>

              <div class="form-group">
                <label>Foto del repuesto (opcional)</label>
                <div
                  class="file-upload"
                  onclick="document.getElementById('file_0').click()"
                >
                  <div class="upload-icon">üì∏</div>
                  <div class="upload-text">Haz clic para subir una foto</div>
                  <div class="file-name" id="filename_0"></div>
                </div>
                <input
                  type="file"
                  id="file_0"
                  name="foto_0"
                  accept="image/*"
                  onchange="handleFileUpload(0)"
                />
                <p class="help-text">JPG, PNG o HEIC - M√°x. 5MB</p>
              </div>
            </div>
          </div>

          <!-- Add More Button -->
          <button
            type="button"
            class="add-repuesto-btn"
            onclick="addRepuesto()"
          >
            <span style="font-size: 1.5rem">+</span>
            Agregar otro repuesto
          </button>

          <!-- Summary -->
          <div class="summary-card">
            <div class="summary-title">üìã Resumen de tu solicitud</div>
            <div class="summary-item">
              <span class="summary-label">Total de repuestos:</span>
              <span class="summary-value" id="totalRepuestos">1</span>
            </div>
            <div class="summary-item">
              <span class="summary-label">Veh√≠culo:</span>
              <span class="summary-value" id="vehiculoSeleccionado"
                >Selecciona un veh√≠culo</span
              >
            </div>
            <div class="summary-item">
              <span class="summary-label">Notificaci√≥n:</span>
              <span class="summary-value">WhatsApp (+56 9 1234 5678)</span>
            </div>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="submit-button">
            Enviar solicitud a vendedores
            <span>üì§</span>
          </button>
        </form>
      </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
      <div class="modal-content">
        <div class="success-icon">‚úì</div>
        <h2 class="modal-title">¬°Solicitud enviada!</h2>
        <p class="modal-message">
          Tu solicitud fue enviada exitosamente a los vendedores especializados.
        </p>
        <div class="modal-highlight">
          <strong>3 vendedores</strong> fueron notificados por WhatsApp
        </div>
        <p class="modal-message">
          Recibir√°s las ofertas directamente en tu WhatsApp.<br />
          Te avisaremos cuando llegue la primera oferta.
        </p>
        <button
          class="submit-button"
          onclick="window.location.href='vista_whasapVendedor.html'"
        >
          Entendido
          <span>üëç</span>
        </button>
      </div>
    </div>

    <script>
      let repuestoCount = 1;

      // Inicializar con el primer veh√≠culo seleccionado
      window.addEventListener("DOMContentLoaded", function () {
        const vehiculoSelect = document.getElementById("vehiculoSelect");
        const selectedText =
          vehiculoSelect.options[vehiculoSelect.selectedIndex].text;
        document.getElementById("vehiculoSeleccionado").textContent =
          selectedText;
      });

      // Manejar selector de veh√≠culo
      document
        .getElementById("vehiculoSelect")
        .addEventListener("change", function () {
          if (this.value) {
            const selectedText = this.options[this.selectedIndex].text;
            document.getElementById("vehiculoSeleccionado").textContent =
              selectedText;
          }
        });

      function addRepuesto() {
        const repuestosList = document.getElementById("repuestosList");
        const newIndex = repuestoCount;

        const repuestoHTML = `
                <div class="repuesto-item" data-index="${newIndex}">
                    <div class="repuesto-header">
                        <span class="repuesto-number">üì¶ Repuesto #${
                          newIndex + 1
                        }</span>
                        <button type="button" class="remove-btn" onclick="removeRepuesto(${newIndex})">
                            üóëÔ∏è
                        </button>
                    </div>

                    <div class="form-group">
                        <label>Nombre del repuesto <span class="required">*</span></label>
                        <input 
                            type="text" 
                            name="nombre_${newIndex}" 
                            placeholder="Ej: Filtro de aceite"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label>Descripci√≥n adicional</label>
                        <textarea 
                            name="descripcion_${newIndex}" 
                            placeholder="Agrega detalles que ayuden a los vendedores"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label>Foto del repuesto (opcional)</label>
                        <div class="file-upload" onclick="document.getElementById('file_${newIndex}').click()">
                            <div class="upload-icon">üì∏</div>
                            <div class="upload-text">Haz clic para subir una foto</div>
                            <div class="file-name" id="filename_${newIndex}"></div>
                        </div>
                        <input 
                            type="file" 
                            id="file_${newIndex}" 
                            name="foto_${newIndex}" 
                            accept="image/*"
                            onchange="handleFileUpload(${newIndex})"
                        >
                    </div>
                </div>
            `;

        repuestosList.insertAdjacentHTML("beforeend", repuestoHTML);
        repuestoCount++;
        updateSummary();

        // Scroll suave al nuevo repuesto
        setTimeout(() => {
          const newItem = document.querySelector(`[data-index="${newIndex}"]`);
          newItem.scrollIntoView({ behavior: "smooth", block: "center" });
        }, 100);
      }

      function removeRepuesto(index) {
        const item = document.querySelector(`[data-index="${index}"]`);
        item.style.animation = "fadeOut 0.3s ease";

        setTimeout(() => {
          item.remove();
          updateSummary();
          renumberRepuestos();
        }, 300);
      }

      function renumberRepuestos() {
        const items = document.querySelectorAll(".repuesto-item");
        items.forEach((item, idx) => {
          const number = item.querySelector(".repuesto-number");
          number.textContent = `üì¶ Repuesto #${idx + 1}`;
        });
      }

      function updateSummary() {
        const totalItems = document.querySelectorAll(".repuesto-item").length;
        document.getElementById("totalRepuestos").textContent = totalItems;
      }

      function handleFileUpload(index) {
        const fileInput = document.getElementById(`file_${index}`);
        const fileName = document.getElementById(`filename_${index}`);
        const fileUpload = fileInput.parentElement;

        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];
          fileName.textContent = `‚úì ${file.name}`;
          fileUpload.classList.add("has-file");
        }
      }

      // Form submission
      document
        .getElementById("busquedaForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          // Validar que se haya seleccionado un veh√≠culo
          const vehiculoSelect = document.getElementById("vehiculoSelect");
          if (!vehiculoSelect.value) {
            alert("Por favor selecciona un veh√≠culo");
            vehiculoSelect.focus();
            return;
          }

          const submitBtn = this.querySelector(".submit-button");
          submitBtn.classList.add("loading");
          submitBtn.disabled = true;

          // Recolectar datos de todos los repuestos
          const repuestos = [];
          const items = document.querySelectorAll(".repuesto-item");

          items.forEach((item, index) => {
            const nombre = item.querySelector(
              `input[name="nombre_${item.dataset.index}"]`
            ).value;
            const descripcion = item.querySelector(
              `textarea[name="descripcion_${item.dataset.index}"]`
            ).value;
            const foto = item.querySelector(
              `input[name="foto_${item.dataset.index}"]`
            ).files[0];

            repuestos.push({
              nombre,
              descripcion,
              foto: foto ? foto.name : null,
            });
          });

          const solicitudData = {
            vehiculoId: vehiculoSelect.value,
            vehiculo: vehiculoSelect.options[vehiculoSelect.selectedIndex].text,
            repuestos: repuestos,
            cliente: {
              nombre: "Juan P√©rez",
              telefono: "+56912345678",
            },
          };

          console.log("Datos de la solicitud:", solicitudData);

          // Simular env√≠o a la API
          await new Promise((resolve) => setTimeout(resolve, 2000));

          // TODO: Aqu√≠ ir√≠a la llamada real a tu API .NET
          // const response = await fetch('/api/solicitudes', {
          //     method: 'POST',
          //     headers: { 'Content-Type': 'application/json' },
          //     body: JSON.stringify(solicitudData)
          // });

          // Mostrar modal de √©xito
          document.getElementById("successModal").classList.add("show");
        });

      // CSS para animaci√≥n de fadeOut
      const style = document.createElement("style");
      style.textContent = `
            @keyframes fadeOut {
                from {
                    opacity: 1;
                    transform: scale(1);
                }
                to {
                    opacity: 0;
                    transform: scale(0.9);
                }
            }
        `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
